name: Release engraved scores

on: workflow_call

jobs:
  engrave_scores:
    runs-on: ubuntu-latest
    container: docker://ghcr.io/edition-esser-skala/ees-tools:v2023.02.0
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Engrave
        run: make -B final/scores

      - name: Compress MIDI files
        run: if [ -d midi ]; then zip -j final/midi_collection.zip midi/*; fi

      - name: Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            final/*.pdf
            final/midi_collection.zip
          fail_on_unmatched_files: false
